import{_ as x,i as S,j as v,s as f,o as c,c as u,a as s,n as h,k as d,F as k,g as F,d as U,t as b,l as D,r as _,f as y,v as w,m as R,b as p,w as C,h as $}from"./index-5723dd2c.js";const E={name:"Upload",data(){return{is_dragover:!1,uploads:[]}},props:["addSong"],methods:{upload(t){this.is_dragover=!1;const e=t.dataTransfer?[...t.dataTransfer.files]:[...t.target.files];e.forEach(r=>{if(r.type!=="audio/ogg")return;if(!navigator.onLine){this.uploads.push({task:{},current_progress:"100",name:r.name,variant:"bg-red-400",icon:"fas fa-times",text_class:"text-red-400"});return}const a=S.ref().child(`songs/${r.name}`).put(r),o=this.uploads.push({task:a,current_progress:0,name:r.name,variant:"bg-blue-400",icon:"fas fa-spinner fa-spin",text_class:""})-1;a.on("state_changed",i=>{const g=i.bytesTransferred/i.totalBytes*100;this.uploads[o].current_progress=g},i=>{this.uploads[o].variant="bg-red-400",this.uploads[o].icon="fas fa-times",this.uploads[o].text_class="text-red-400",console.log(i)},async()=>{const i={uid:v.currentUser.uid,display_name:v.currentUser.displayName,original_name:a.snapshot.ref.name,modified_name:a.snapshot.ref.name,genre:"",comment_count:0};i.url=await a.snapshot.ref.getDownloadURL();const l=await(await f.add(i)).get();this.addSong(l),this.uploads[o].variant="bg-green-400",this.uploads[o].icon="fas fa-check",this.uploads[o].text_class="text-green-400"})}),console.log(e)},cancelUploads(){this.uploads.forEach(t=>{t.task.cancel()})}},beforeUnmount(){this.uploads.forEach(t=>{t.task.cancel()})}},I={class:"bg-white rounded border border-gray-200 relative flex flex-col"},B=s("div",{class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},[s("span",{class:"card-title"},"Upload"),s("i",{class:"fas fa-upload float-right text-green-400 text-2xl"})],-1),N={class:"p-6"},T=s("h5",null,"Drop your files here",-1),q=[T],M=s("hr",{class:"my-6"},null,-1),L={class:"flex h-4 overflow-hidden bg-gray-200 rounded"};function V(t,e,r,m,n,a){return c(),u("div",I,[B,s("div",N,[s("div",{class:h(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid",{"bg-green-400 border-green-400 border-solid":n.is_dragover}]),onDrag:e[0]||(e[0]=d(()=>{},["prevent","stop"])),onDragstart:e[1]||(e[1]=d(()=>{},["prevent","stop"])),onDragend:e[2]||(e[2]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDragover:e[3]||(e[3]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragenter:e[4]||(e[4]=d(o=>n.is_dragover=!0,["prevent","stop"])),onDragleave:e[5]||(e[5]=d(o=>n.is_dragover=!1,["prevent","stop"])),onDrop:e[6]||(e[6]=d(o=>a.upload(o),["prevent","stop"]))},q,34),s("input",{type:"file",multiple:"",onChange:e[7]||(e[7]=o=>a.upload(o))},null,32),M,(c(!0),u(k,null,F(n.uploads,o=>(c(),u("div",{class:"mb-4",key:o.name},[s("div",{class:h(["font-bold text-sm",o.text_class])},[s("i",{class:h(o.icon)},null,2),U(" "+b(o.name),1)],2),s("div",L,[s("div",{class:h(["transition-all progress-bar",o.variant]),style:D({width:o.current_progress+"%"})},null,6)])]))),128))])])}const j=x(E,[["render",V]]),z={name:"CompositionItem",props:{song:{type:Object,required:!0},updateSong:{type:Function,required:!0},index:{type:Number,required:!0},removeSong:{type:Function,required:!0},updateUnsavedFlag:{type:Function}},data(){return{showForm:!1,schema:{modified_name:"required",genre:"alpha_spaces"},in_submission:!1,show_alert:!1,alert_variant:"bg-blue-500",alert_message:"Please wait! Updating song info"}},methods:{async edit(t){this.in_submission=!0,this.show_alert=!0,this.alert_variant="bg-blue-500",this.alert_message="Please wait! Updating song info";try{await f.doc(this.song.docID).update(t)}catch{this.in_submission=!1,this.alert_variant="bg-red-500",this.alert_message="Something went wrong! Try again later";return}this.updateSong(this.index,t),this.updateUnsavedFlag(!1),this.in_submission=!1,this.alert_variant="bg-green-500",this.alert_message="Success!"},async deleteSong(){await S.ref().child(`songs/${this.song.original_name}`).delete(),await f.doc(this.song.docID).delete(),this.removeSong(this.index)}}},A={class:"border border-gray-200 p-3 mb-4 rounded"},G={class:"inline-block text-2xl font-bold"},P=s("i",{class:"fa fa-times"},null,-1),O=[P],Y=s("i",{class:"fa fa-pencil-alt"},null,-1),H=[Y],J={class:"mb-3"},K=s("label",{class:"inline-block mb-2"},"歌名",-1),Q={class:"mb-3"},W=s("label",{class:"inline-block mb-2"},"类型",-1),X=["disabled"],Z=["disabled"];function ee(t,e,r,m,n,a){const o=_("vee-field"),i=_("ErrorMessage"),g=_("vee-form");return c(),u("div",A,[y(s("div",null,[s("h4",G,b(r.song.modified_name),1),s("button",{onClick:e[0]||(e[0]=d((...l)=>a.deleteSong&&a.deleteSong(...l),["prevent"])),class:"ml-1 py-1 px-2 text-sm rounded text-white bg-red-600 float-right"},O),s("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-blue-600 float-right",onClick:e[1]||(e[1]=d(l=>n.showForm=!n.showForm,["prevent"]))},H)],512),[[w,!n.showForm]]),y(s("div",null,[n.show_alert?(c(),u("div",{key:0,class:h(["text-white text-center font-bold p-4 mb-4",n.alert_variant])},b(n.alert_message),3)):R("",!0),p(g,{onSubmit:a.edit,"validation-schema":n.schema,"initial-values":r.song},{default:C(()=>[s("div",J,[K,p(o,{name:"modified_name",type:"text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Song Title",onInput:e[2]||(e[2]=l=>r.updateUnsavedFlag(!0))}),p(i,{class:"text-red-600",name:"modified_name"})]),s("div",Q,[W,p(o,{name:"genre",type:"text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Genre",onInput:e[3]||(e[3]=l=>r.updateUnsavedFlag(!0))}),p(i,{class:"text-red-600",name:"genre"})]),s("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600",disabled:n.in_submission}," Submit ",8,X),s("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-gray-600",disabled:n.in_submission,onClick:e[4]||(e[4]=d(l=>n.showForm=!1,["prevent"]))}," Go Back ",8,Z)]),_:1},8,["onSubmit","validation-schema","initial-values"])],512),[[w,n.showForm]])])}const se=x(z,[["render",ee]]),te={name:"Manage",components:{AppUpload:j,CompositionItem:se},data(){return{songs:[],unsavedFlag:!1}},async created(){(await f.where("uid","==",v.currentUser.uid).get()).forEach(this.addSong)},methods:{updateSong(t,e){this.songs[t].modified_name=e.modified_name,this.songs[t].genre=e.genre},removeSong(t){this.songs.splice(t,1)},addSong(t){const e={...t.data(),docID:t.id};this.songs.push(e)},updateUnsavedFlag(t){this.unsavedFlag=t}},beforeRouteLeave(t,e,r){if(!this.unsavedFlag)r();else{const m=confirm("You have unsaved changes. Are you sure you want to leave?");r(m)}}},oe={class:"container mx-auto mt-6"},ne={class:"md:grid md:grid-cols-3 md:gap-4"},ae={class:"col-span-1"},re={class:"col-span-2"},ie={class:"bg-white rounded border border-gray-200 relative flex flex-col"},de={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},le={class:"card-title"},ce=s("i",{class:"fa fa-compact-disc float-right text-green-400 text-2xl"},null,-1),ge={class:"p-6"};function ue(t,e,r,m,n,a){const o=_("app-upload"),i=_("composition-item");return c(),u("section",oe,[s("div",ne,[s("div",ae,[p(o,{ref:"upload",addSong:a.addSong},null,8,["addSong"])]),s("div",re,[s("div",ie,[s("div",de,[s("span",le,b(t.$t("manage.my_songs")),1),ce]),s("div",ge,[(c(!0),u(k,null,F(n.songs,(g,l)=>(c(),$(i,{key:g.docID,song:g,updateSong:a.updateSong,index:l,removeSong:a.removeSong,updateUnsavedFlag:a.updateUnsavedFlag},null,8,["song","updateSong","index","removeSong","updateUnsavedFlag"]))),128))])])])])])}const me=x(te,[["render",ue]]);export{me as default};
