import{_ as w,p as y,u as v,s as u,q as k,x as C,j as _,y as h,r as d,o as i,c as m,a as e,k as S,t as n,n as D,m as g,h as P,w as q,b,f as z,z as E,F as B,g as I}from"./index-5723dd2c.js";const L={name:"Song",data(){return{song:{},schema:{comment:"required|min:3"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"bg-blue-500",comment_alert_message:"Please wait! Your comment is being submitted",comments:[],sort:"1"}},computed:{...y(v,["userLoggedIn"]),sortedComments(){return this.comments.slice().sort((s,o)=>this.sort==="1"?new Date(o.datePosted)-new Date(s.datePosted):new Date(s.datePosted)-new Date(o.datePosted))}},async beforeRouteEnter(s,o,c){const l=await u.doc(s.params.id).get();c(t=>{if(!l.exists){t.$router.push({name:"home"});return}const{sort:a}=t.$route.query;t.sort=a==="1"||a==="2"?a:"1",t.song=l.data(),t.getComments()})},methods:{...k(C,["newSong"]),async addComment(s,{resetForm:o}){this.comment_in_submission=!0,this.comment_show_alert=!0,this.comment_alert_variant="bg-blue-500",this.comment_alert_message="Please wait! Your comment is being submitted";const c={content:s.comment,datePosted:new Date().toString(),sid:this.$route.params.id,name:_.currentUser.displayName,uid:_.currentUser.uid};await h.add(c),this.song.comment_count+=1,await u.doc(this.$route.params.id).update({comment_count:this.song.comment_count}),this.getComments(),this.comment_in_submission=!1,this.comment_alert_variant="bg-green-500",this.comment_alert_message="Comment added!",o()},async getComments(){const s=await h.where("sid","==",this.$route.params.id).get();this.comments=[],s.forEach(o=>{this.comments.push({docID:o.id,...o.data()})})}},watch:{sort(s){s!==this.$route.query.sort&&this.$router.push({query:{sort:s}})}}},M={class:"w-full mb-8 py-14 text-center text-white relative"},N=e("div",{class:"absolute inset-0 w-full h-full box-border bg-contain music-bg",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),U={class:"container mx-auto flex items-center"},V=e("i",{class:"fas fa-play"},null,-1),Y=[V],F={class:"z-50 text-left ml-8"},j={class:"text-3xl font-bold"},A={class:"song-price"},O={class:"container mx-auto mt-6",id:"comments"},R={class:"bg-white rounded border border-gray-200 relative flex flex-col"},G={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},H={class:"card-title"},J=e("i",{class:"fa fa-comments float-right text-green-400 text-2xl"},null,-1),K={class:"p-6"},Q=["disabled"],T=e("option",{value:"1"},"Latest",-1),W=e("option",{value:"2"},"Oldest",-1),X=[T,W],Z={class:"container mx-auto"},$={class:"mb-5"},ee={class:"font-bold"};function te(s,o,c,l,t,a){const p=d("vee-field"),f=d("ErrorMessage"),x=d("vee-form");return i(),m("main",null,[e("section",M,[N,e("div",U,[e("button",{onClick:o[0]||(o[0]=S(r=>s.newSong(t.song),["prevent"])),type:"button",class:"z-50 h-24 w-24 text-3xl bg-white text-black rounded-full focus:outline-none"},Y),e("div",F,[e("div",j,n(t.song.modified_name),1),e("div",null,n(t.song.genre),1),e("div",A,n(s.$n(1,"currency","zh")),1)])])]),e("section",O,[e("div",R,[e("div",G,[e("span",H,n(s.$tc("song.comment_count",t.song.comment_count,{count:t.song.comment_count})),1),J]),e("div",K,[t.comment_show_alert?(i(),m("div",{key:0,class:D(["text-white text-center font-bold p-4 mb-4",t.comment_alert_variant])},n(t.comment_alert_message),3)):g("",!0),s.userLoggedIn?(i(),P(x,{key:1,"validation-schema":t.schema,onSubmit:a.addComment},{default:q(()=>[b(p,{as:"textarea",name:"comment",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded mb-4",placeholder:"Your comment here..."}),b(f,{class:"text-red-600",name:"comment"}),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:t.comment_in_submission}," Submit ",8,Q)]),_:1},8,["validation-schema","onSubmit"])):g("",!0),z(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>t.sort=r),class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded"},X,512),[[E,t.sort]])])])]),e("ul",Z,[(i(!0),m(B,null,I(a.sortedComments,r=>(i(),m("li",{class:"p-6 bg-gray-50 border border-gray-200",key:r.docID},[e("div",$,[e("div",ee,n(r.name),1),e("time",null,n(r.datePosted),1)]),e("p",null,n(r.content),1)]))),128))])])}const oe=w(L,[["render",te]]);export{oe as default};
